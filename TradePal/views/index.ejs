<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Trading App</title>
  <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
  <h1>Live Bitcoin Price: $<span id="livePrice"><%= livePrice %></span></h1>

  <!-- User Form -->
  <h2>Create a New User</h2>
  <form action="/users" method="POST">
    <input type="text" name="username" placeholder="Enter Username" required>
    <button type="submit">Create User</button>
  </form>

  <!-- Trade Form -->
  <h2>Make a Trade</h2>
  <form action="/trades/trade" method="POST">
    <select name="userId">
      <% users.forEach(user => { %>
        <option value="<%= user.id %>"><%= user.username %></option>
      <% }) %>
    </select>
    <button type="submit" name="orderType" value="BUY">Buy</button>
    <button type="submit" name="orderType" value="SELL">Sell</button>
  </form>

  <!-- Orders -->
  <h2>Open Orders</h2>
  <ul>
    <% orders.forEach(order => { %>
      <li>
        User: <%= order.username %>, Type: <%= order.orderType %>, Price: $<%= order.price %>, Time: <%= order.time %>, Status: <%= order.status %>
        <% if (order.status === 'Open') { %>
          <form action="/trades/close-order/<%= order.id %>" method="POST">
            <button type="submit">Close Order</button>
          </form>
        <% } else { %>
          - Result: <%= order.result %>
        <% } %>
      </li>
    <% }) %>
  </ul>
  
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        function updatePrice() {
          fetch('/trades/live-price')
            .then(response => response.json())
            .then(data => {
              const livePrice = parseFloat(data.livePrice);
              document.getElementById('livePrice').textContent = 
                isNaN(livePrice) ? 'N/A' : livePrice.toFixed(2);
            })
            .catch(error => console.error('Error fetching live price:', error));
        }
  
        setInterval(updatePrice, 1000);
        updatePrice(); // Initial call to set the price immediately on load
      });
    </script> 

</body>
</html>
